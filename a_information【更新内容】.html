＜お知らせ＞
本ソースコードのみでは実装が難しい方のために、「はむとれ簡単導入マニュアル」を用意しています。
無料でダウンロード可能です。
https://www.hamutore.erizo.co.jp/manual/

更新内容
-----------------------------------------------------------
Ver8.0 - 2020/11/8
-----------------------------------------------------------
(1)mail版とwebhook版の注文処理を共通化しました。
(2)一部リトライ条件を変更しました。
(3)取引所とはむとれ間のポジションチェックを行う機能を追加しました。

-----------------------------------------------------------
Ver7.5 - 2020/10/1
-----------------------------------------------------------
(1)デフォルトメッセージでドテン型が正常に動作しない問題を修正しました。
(2)webhookのリトライ条件を微修正しました。
(3)デフォルトメッセージを利用したときポジションサイズのチェックを行うようにしました。

-----------------------------------------------------------
Ver7.4 - 2020/6/7
-----------------------------------------------------------
(1)ストラテジー名が数字のみのときの売買の修正漏れを解消しました。
(2)propertyの環境変数方式に対応しました。
(3)strategy alertのデフォルトメッセージで動作するようにしました。

-----------------------------------------------------------
Ver7.3 - 2020/6/4
-----------------------------------------------------------
(1)TradingViewの仕様変更に伴いメール形式での売買が行えるように修正しました。

-----------------------------------------------------------
Ver7.2 - 2020/5/20
-----------------------------------------------------------
(1)bybit本番環境のhistoryUpdaterが正常に働かない問題を修正しました。

-----------------------------------------------------------
Ver7.1 - 2020/5/18
-----------------------------------------------------------
(1)spread sheetに並列に書きこんだ時に正しく追加されない問題を修正しました

-----------------------------------------------------------
Ver7.0 - 2020/5/17
-----------------------------------------------------------
(1)ストラテジー名が数字のみのときにも正常に売買が行われるようにしました。
(2)bitflyerの価格取得に関する修正を行い、注文高速化とAPI節約が行われるようにしました。
(3)Webhook対応は良く考えたらメジャーアップデートと呼べるものなのでver名をを7.0に変更しました。

-----------------------------------------------------------
Ver6.3 - 2020/5/16
-----------------------------------------------------------
(1)従来のメール受信機能を復活しました
(2)TriggerSettingでHamsterを復活しました

-----------------------------------------------------------
Ver6.2 - 2020/5/10
-----------------------------------------------------------
(1)CLOSE,BUYALERT,SELLALERTに対応しました
(2)positionで判定しました(BUY:1,SELL:-1,CLOSE:0,BUYALERT:100,SELLALERT:-100)
(3)従来のメール受信機能を削除しました
(4)TriggerSettingで余分であったHamsterを削除しました

-----------------------------------------------------------
Ver6.1 - 2020/5/03
-----------------------------------------------------------
(1)特殊なメッセージのフォーマットに対応しました
(2)webhookに対応しました

-----------------------------------------------------------
Ver6.0 - 2020/5/01
-----------------------------------------------------------
(1)Bybitに対応しました
(2)BitMEX, BitMEX testnetを削除しました
(3)指値価格追跡機能を削除しました
(4)Latsを削除しました

-----------------------------------------------------------
Ver5.5 - 2020/3/31
-----------------------------------------------------------
(1)ver5.6ではLimitが仕様通りに動かない現象が見られたため、ソースコードをver5.5のものに差し戻しました。
ランタイムは有効にせず無効のままにしてください。
もし有効にしてしまった場合は、実行→ランタイムを無効にする、で無効にしてください。

-----------------------------------------------------------
Ver5.6 - 2020/3/22
-----------------------------------------------------------
(1)Chrome V8を搭載した新しいApps Scriptランタイムが有効なときに機能するように変更しました。
【説明】Googleのアップデートに合わせてソースコードを一部修正しました。

-----------------------------------------------------------
Ver5.5 - 2020/2/24
-----------------------------------------------------------
(1)a_propertyの修正
【説明】BitMEX_minimumVolumeの値を1.0に変更しました。

-----------------------------------------------------------
Ver5.4 - 2020/2/18
-----------------------------------------------------------
(1)はじめに の内容修正
【説明】はじめに の内容を現在の状況に即したものに変更しました。
ソースコードに変更箇所はございません。

-----------------------------------------------------------
Ver5.3 - 2019/11/25
-----------------------------------------------------------
(1)s_messageの微修正
【説明】システム仕様変更によりDiscordへの通知が来なくなっていた不具合を修正しました。

-----------------------------------------------------------
Ver5.2 - 2019/11/4
-----------------------------------------------------------
(1)c_profitの微修正
【説明】historyのTotalVolumeが正しく記載されないパターンが発生する不具合を修正しました。

-----------------------------------------------------------
Ver5.1 - 2019/10/12
-----------------------------------------------------------
(1)PositionとStrategyの配置
【説明】PositionとStrategyが入れ替わっていたので、修正しました。
(2)totalVolumeの取得
【説明】totalVolumeの取得を修正しました。
(3)その他微修正

-----------------------------------------------------------
Ver5.0 - 2019/10/05
-----------------------------------------------------------
(1)FusionTableからスプレッドシートへの移行
【説明】Google Fusion Tablesが2019/12/03に廃止されるため、スプレッドシートへの移行を実施しました。
https://developers.google.com/fusiontables/
スクリプト更新のしやすさを考慮し、スプレッドシートとGoogle Apps Scriptは別ファイルとしました。
createFusionTables.gsを削除しました。
Test_Hello.gsと重複していたので、Test_sendMessage.gsを削除しました。
Test_Tables.gsをTest_getSheetに変更しました。
(2)価格追従時の金額変更
どの通貨でもbidまたはaskになるように変更しました。
(3)はむとれオープンソース化
【説明】本バージョンからはむとれのスクリプトをオープンソース化します。
(4)sendMyStrategies削除
【説明】sendMyStrategies.gsを削除しました。
(5)先物注文履歴取得
【説明】先物が上手く取得できるようにしました。
(6)その他微修正

-----------------------------------------------------------
Ver4.5 - 2019/09/02
-----------------------------------------------------------
(1)1970年対策
【説明】1970年対策を再実施しました。
取引所からの時間に小数点がない時に変換失敗している可能性がありました。
小数点がない場合に補正することで問題を解消します。
加えて、バックアップとしてnew Date()を繰り返す機構も追加しました。
(2)ETH先物
【説明】ETHの先物が注文できなかったため、修正しました。
(3)その他微修正

-----------------------------------------------------------
Ver4.4 - 2019/05/10
-----------------------------------------------------------
(1)1970年対策
【説明】1970年対策を実施しました。
JST→Asia/Tokyo
yyyyが1970の時に時間に現在時刻を代入

-----------------------------------------------------------
Ver4.3 - 2019/05/04
-----------------------------------------------------------
(1)BoostModeのデフォルト設定をOFFにしました。(必要に応じてONにしてください)
(2)BitMEXの最低注文価格デフォルト設定を$25に変更しました。(必要に応じて変更してください)

-----------------------------------------------------------
Ver4.2 - 2019/04/25
-----------------------------------------------------------
(1)errorcountのリセット
【説明】注文完了時にerrorcountが0になるように修正しました。

-----------------------------------------------------------
Ver4.1 - 2019/04/20
-----------------------------------------------------------
(1)BitMEXの最低注文金額の変更
【説明】BitMEXの最低注文金額を変更できるように修正しました。
【初期設定】propertyのminimumVlumeの値を任意に設定してください。

-----------------------------------------------------------
Ver4.0 - 2019/01/18
-----------------------------------------------------------
(1)statusの分割
【説明】誤記入を防ぐため、statusをbitmex用とbitflyer用に分割しました。
【初期設定】a_createFusionTablesからcreateFusionTablesを実行し、status_bitflyerとstatus_bitmexを追加してください。
　　　　　　それに伴い、propertyのstatusTableIdを変更してください。(statusTableId→statusTableId_bitflyer, statusTableId_bitmex)
　　　　　　また、statusは今後使用しないため、削除してください。

(2)bitMEXの注文単位の変更
【説明】取引において価格変換による端数のずれが発生するため、BTCから$に変更しました。
【初期設定】volumeの価格を$単位に修正してください。

(3)CLOSE注文におけるstrategy名の記載
【説明】bitFlyerのCLOSE注文の際に既にtotalvolumeが0であった場合、通知を出していましたが、strategy名の記載がなかったため、追記しました。

(4)強制停止エラーの緩和
【説明】サーバー混雑時に受け渡しエラー起因の強制停止が発生したため、10回連続で緊急停止エラーが発生した場合のみ緊急停止するように修正しました。
【初回設定方法】a_createFusionTablesからcreateFusionTablesを実行し、statusTableにErrorの欄を追加してください。

(5)Time未収得バグ対策修正
【説明】Time習得時に抜けがでないよう、数値で判断するように明示しました。

(6)bitFlyerでの注文期限の変更
【説明】速度向上のため、注文期限を1分に変更しました。

(7)bitMEXでの指値の変更
【説明】Maker注文を向上させるため、指値をbit値またはask値に変更しました。

-----------------------------------------------------------
Ver3.4 - 2018/12/28
-----------------------------------------------------------
(1)通知重複問題対策
【説明】間違った通知が混じることがあったため、コードを修正しました。

(2)CLOSE注文におけるstrategy名の記載
【説明】CLOSE注文の際に既にtotalvolumeが0であった場合、通知を出していましたが、strategy名の記載がなかったため、追記しました。

(3)BitMEXでの価格更新方法の変更
【説明】価格更新の際、手順をキャンセル→再注文にしていましたが、直接価格更新を行うように変更しました。

(4)bitFlyerでの価格更新方法の変更
【説明】注文期限を10分とし、注文期限に達した時点で再注文するように変更しました。

-----------------------------------------------------------
Ver3.3 - 2018/12/16
-----------------------------------------------------------
(1)HamsterLimitでのACTIVE確認追加
【説明】ACTIVEがON以外の時にorderTableから注文を削除するように修正しました。

(2)bitFlyerのエンドポイント変更
【説明】bitFlyerの推奨エンドポイントが変わっていたので、変更しました。

-----------------------------------------------------------
Ver3.2 - 2018/12/12
-----------------------------------------------------------
(1)bitFlyerのID消失バグ対策
【説明】エラー回数をカウントし、10回以上になったら再注文するように変更しました。
【初回設定方法】a_createFusionTablesからcreateFusionTablesを実行し、orderTableにErrorcountの欄を追加してください。

(2)bitFlyerのETHUSD発注バグ
【説明】発注単位がETHになっていたため、修正しました。

(3)ActiveのONの記述形式追加
【説明】ON以外にOn, onでも稼働するように変更しました。

(4)totalvolumeのTypeError改善
【説明】totalvolumeが文字として処理される場合が極稀に発生したため、数値に変換する処理を追加しました。

(5)bitFlyerの注文時間不明バグ対策
【説明】bitFlyerが時間を返さない場合(または1970年と検討違いの時間を返す場合)、現在の時刻に置き換えるように変更しました。

(6)Discord通知テスト用コード修正
【説明】DiscordUrlのところがDiscordTokenになっていたので、修正しました。

(7)Cannot find function toFixed対策
【説明】不定期に数字が文字に変換されることがあったため、数字変換を明記しました。

(8)Time未収得バグ対策
【説明】Line・Discord通知時に極々稀にTimeの取得がうまく行かず、表記がおかしくなるため、取得が上手くいかなかったときは現時間で代替するようにしました。

-----------------------------------------------------------
Ver3.1 - 2018/11/11
-----------------------------------------------------------
(1) 分割注文機能削除
【説明】指値対応により重要性が薄れたこと、バグが発生することを理由に削除しました。

(2)Updaterのメッセージ修正
【説明】Undefinedのメッセージが表示されないように修正しました。

(3)bitFlyerのID消失バグ対策
【説明】IDから注文情報が得られない場合、後回しにすることで他注文が止まらないように修正しました。

(4)bitFlyerのorderTypeの指定
【説明】bitFlyerのorderTypeにLIMITまたはMARKETが明記されていない場合、エラーがでるように修正しました。(bitmexはver3.0で対応済)

(5)bitFlyerの指値設定をlastpriceからask,bid値に変更
【説明】より好ましい価格で注文するために価格設定を変更しました。(bitmexはver3.0で対応済)

(6)bitmexのETHUSD指値変更
【説明】bitmexの価格設定でETHUSDの時に±0.5で指してしまうバグを修正しました。

(7)ストラテジー緊急停止用エラー条件更新
【説明】ストラテジーを緊急停止するエラーの条件を修正しました。

(8)bitFlyerの一部約定時における注文情報バグ対策
【説明】bitFlyerから返ってくる注文情報に誤り(ACTIVEなのにoutstandingが0)がある場合がありましたので、その際に注文を削除しない対策しました。

-----------------------------------------------------------
Ver3.0
-----------------------------------------------------------
(1) 指値注文対応
【説明】ストラテジー毎に指値or成行注文設定
【入力値】OrderType：MARKET or LIMIT
【初回設定方法】
　1. a_createFusionTablesのCreateFusionTablesを実行
　2. property.gsに自動生成したorderのorderTableId貼り付け
　3. Hamsterlimitをトリガーに設定(毎分1回)。

(2) Sukuwaさん要望 分割注文対応
【説明】bitflyer,bitmex,bitmex_testnetともに指定枚数を超える注文は指定枚数毎に分割注文する
【入力値】
　分割有無
　　bitflyer_splitting ON or OFF
　　bitmex_splitting ON or OFF
　指定枚数
　　bitflyer_splitting_unit X[BTC]
　　bitmex_splitting_unit X[BTC]
【設定方法】property.gsに記入

(3) アルトコイン対応
【説明】各取引所のコインに対応
【入力値】statusのProductCodeに記入

 BitFlyer ProductCode一覧
 "BTC_JPY"
 "FX_BTC_JPY"
 "ETH_BTC"
 "BCH_BTC"

 BitMEX Symbol一覧
 "XBTUSD"
 "ETHUSD"
 "XBT_SAKIMONO"
 "ETH_SAKIMONO"
 "ADA_SAKIMONO"
 "BCH_SAKIMONO"
 "EOS_SAKIMONO"
 "LTC_SAKIMONO"
 "TRX_SAKIMONO"
 "XRP_SAKIMONO"

(4) suzu311さん要望 アラートによるストラテジーON/OFF機能
【説明】positionにSON(指定のストラテジーをONにする)またはSOFF(指定のストラテジーをOFFにする)を記入
【入力値】position SON or SOFF

(5) 00さん要望 ロット自動調整機能(Lot Auto-Tuning System: LATS)
【説明】ロットを証拠金に応じて自動調整
　Lats：0 ~ 1.0
　レバレッジX(倍)
　オーダー数量 ＝ 証拠金(BTC) × X × Lats
【設定方法】statusにLats(text)追加

(6)Discord通知機能
【設定方法】property.gsにDiscordUrlを記入

(7)ぺんぺんキャッシュさん、tAKUさん要望　通知のみ稼働
【設定方法】positionにBUYALERTまたはSELLALERTを記入
【入力値】position BUYALERT or SELLALERT

(8)Profit, AveragePrice, totalVolume対応
【説明】historyに利益、平均価格、全取引量を記入
【初回設定方法】historyにProfit, AveragePrice, totalVolume(Number)追加

(9)Updater更新
【説明】アルトコイン, Profit対応

(10)Trigger自動設定
【説明】ONの場合、3個トリガーを設定。OFFの場合、1個トリガーを設定。
【入力値】BoostMode ON or OFF
 ※時間の調整は行いません

(11)Close対応
【設定方法】positionにCLOSEを記入
【入力値】position CLOSE

(12)重大エラー時のメール通知(約定連絡はありません)
【初回設定方法】AlertMailAddressにメールアドレスを記入(記入したメールアドレスに通知します)

(13)緊急停止ボタン設置
【設定方法】status.gsのemergency_stopをご利用ください。全ストラテジーのActiveがOFFになります。
